generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String             @id @default(uuid())
  name                String
  email               String             @unique
  password            String
  role                UserRole           @default(PLAYER)
  playerProfileId     String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  phoneNumber         String?
  countryCode         String?
  city                String?
  state               String?
  country             String?
  pincode             String?
  profilePicture      String?
  documentNumber      String?
  documentPhotos      String[]
  verificationStatus  VerificationStatus @default(PENDING)
  verificationRemarks String?
  verifiedBy          String?
  verifiedAt          DateTime?
  clubName            String?
  playerProfile       PlayerProfile?
  scoutReports        ScoutReport[]
  uploadedVideos      UploadedVideo[]
  videoSelections     VideoSelection[]
}

model PlayerProfile {
  id                 String               @id @default(uuid())
  userId             String               @unique
  age                Int
  position           String
  club               String?
  nationality        String?
  speed              Float?
  dribbling          Float?
  passing            Float?
  shooting           Float?
  defending          Float?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  performanceMetrics PerformanceMetrics[]
  user               User                 @relation(fields: [userId], references: [id])
  scoutReports       ScoutReport[]
  uploadedVideos     UploadedVideo[]
}

model UploadedVideo {
  id                 String               @id @default(uuid())
  userId             String
  playerProfileId    String?
  videoUrl           String
  googleDriveFileId  String?
  status             VideoStatus          @default(PENDING)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  processedData      AIAnalysisData?
  performanceMetrics PerformanceMetrics[]
  playerProfile      PlayerProfile?       @relation(fields: [playerProfileId], references: [id])
  user               User                 @relation(fields: [userId], references: [id])
  videoSelections    VideoSelection[]
}

model AIAnalysisData {
  id               String        @id @default(uuid())
  videoId          String        @unique
  detectedPlayerId String
  trackingData     Json
  keyEvents        Json
  createdAt        DateTime      @default(now())
  uploadedVideo    UploadedVideo @relation(fields: [videoId], references: [id])
}

model PerformanceMetrics {
  id              String         @id @default(uuid())
  playerProfileId String
  speed           Float
  dribbling       Float
  passing         Float
  shooting        Float
  agility         Float
  stamina         Float
  intelligence    Float
  createdAt       DateTime       @default(now())
  videoId         String?
  playerProfile   PlayerProfile  @relation(fields: [playerProfileId], references: [id])
  video           UploadedVideo? @relation(fields: [videoId], references: [id])
}

model ScoutReport {
  id              String        @id @default(uuid())
  scoutId         String
  playerProfileId String
  rating          Float
  comments        String?
  createdAt       DateTime      @default(now())
  playerProfile   PlayerProfile @relation(fields: [playerProfileId], references: [id])
  scout           User          @relation(fields: [scoutId], references: [id])
}

model VideoSelection {
  id         String          @id @default(uuid())
  videoId    String
  scoutId    String
  status     SelectionStatus @default(VIEWED)
  clubName   String?
  comments   String?
  selectedAt DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  scout      User            @relation(fields: [scoutId], references: [id])
  video      UploadedVideo   @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([videoId, scoutId])
  @@index([videoId])
  @@index([scoutId])
}

enum UserRole {
  PLAYER
  SCOUT
  ADMIN
}

enum VerificationStatus {
  VERIFIED
  PENDING
  REJECTED
}

enum VideoStatus {
  PENDING
  PROCESSING
  ANALYZED
}

enum SelectionStatus {
  VIEWED
  INTERESTED
  SELECTED
  REJECTED
}
